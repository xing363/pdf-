<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>增强版PDF文件管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --light-bg: #f8f9fa;
            --dark-text: #212529;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --border-radius: 12px;
            --box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e0f7fa 0%, #d0e8ff 100%);
            min-height: 100vh;
            padding: 25px;
            color: var(--dark-text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            border-left: 6px solid var(--primary-color);
            background: linear-gradient(135deg, #ffffff 0%, #f8faff 100%);
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        header h1 i {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #4361ee 0%, #3f37c9 100%);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.3);
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.85;
            max-width: 700px;
            margin: 15px auto 0;
            color: #4a5568;
            padding: 12px 25px;
            background: rgba(67, 97, 238, 0.05);
            border-radius: 50px;
            font-weight: 500;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 35px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: linear-gradient(135deg, #ffffff 0%, #f8faff 100%);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            border-top: 3px solid var(--primary-color);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9effd;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .card h2 i {
            font-size: 1.4rem;
        }

        .upload-area {
            border: 2px dashed #90caf9;
            border-radius: var(--border-radius);
            padding: 45px 20px;
            text-align: center;
            background-color: #f0f7ff;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: linear-gradient(to right, #edf4ff, #e3eeff);
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary-color);
            background: linear-gradient(to right, #e3eeff, #d6e5ff);
        }

        .upload-area i {
            font-size: 3.5rem;
            color: #64b5f6;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #4361ee 0%, #3f37c9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .upload-area p {
            margin: 12px 0;
            color: #1976d2;
            font-size: 1.15rem;
            font-weight: 500;
        }

        .upload-area .small {
            font-size: 0.95rem;
            color: #5a6b8d;
            margin-top: 20px;
            display: block;
        }

        #file-input {
            display: none;
        }

        .btn {
            display: inline-block;
            padding: 14px 32px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #3f5ee3 0%, #3933c2 100%);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #d63031 0%, #b3392b 100%);
        }

        .search-container {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .search-container input {
            flex: 1;
            padding: 16px 25px;
            border: 1px solid #e2e8f0;
            border-radius: 50px;
            font-size: 1.05rem;
            box-shadow: inset 0 3px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            background: #f5f8ff;
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: inset 0 3px 8px rgba(67, 97, 238, 0.1), 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        .sort-options {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .sort-option {
            background: linear-gradient(to right, #e3f2fd, #d6e7ff);
            padding: 10px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #1976d2;
            border: 1px solid #bbdefb;
            font-size: 1.05rem;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }

        .sort-option:hover {
            background: linear-gradient(to right, #d6e7ff, #c9ddfe);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
        }

        .sort-option.active {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .file-list {
            margin-top: 30px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 25px;
            background: linear-gradient(to right, #f8fbff, #f0f5ff);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.07);
            margin-bottom: 20px;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .file-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12);
            background: linear-gradient(to right, #f0f5ff, #e8f0ff);
        }

        .file-item:hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        }

        .file-icon {
            font-size: 2.2rem;
            color: #f44336;
            margin-right: 25px;
            padding: 18px;
            background: linear-gradient(to bottom right, #ffeeee, #ffdddd);
            border-radius: 50%;
            width: 65px;
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(244, 67, 54, 0.2);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 700;
            margin-bottom: 10px;
            color: #2c5282;
            font-size: 1.2rem;
            word-break: break-word;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-meta {
            display: flex;
            gap: 25px;
            color: #4a5568;
            font-size: 1rem;
            flex-wrap: wrap;
        }

        .file-date {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .file-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.85);
            border: none;
            padding: 14px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            font-size: 1.3rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .open-btn {
            color: var(--primary-color);
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.15), rgba(63, 55, 201, 0.1));
        }

        .open-btn:hover {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.25), rgba(63, 55, 201, 0.2));
        }

        .download-btn {
            color: var(--success);
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(38, 174, 95, 0.1));
        }

        .download-btn:hover {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.25), rgba(38, 174, 95, 0.2));
        }

        .delete-btn {
            color: var(--danger);
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15), rgba(192, 57, 43, 0.1));
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.25), rgba(192, 57, 43, 0.2));
        }

        .status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-uploaded {
            background: linear-gradient(to right, rgba(46, 204, 113, 0.2), rgba(39, 174, 96, 0.15));
            color: #27ae60;
        }

        .upload-progress {
            background: linear-gradient(to right, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.08));
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            height: 12px;
            background-color: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 15px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #3d5afe, #2979ff);
            width: 0%;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .info-box {
            background: linear-gradient(to right, rgba(67, 97, 238, 0.1), rgba(63, 55, 201, 0.08));
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            margin-top: 25px;
            display: none;
        }

        .file-count {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-size: 1rem;
            margin-left: 12px;
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(67, 97, 238, 0.3);
        }

        /* 预览模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8faff 100%);
            border-radius: var(--border-radius);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.35);
            width: 90%;
            height: 90%;
            padding: 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(67, 97, 238, 0.2);
        }

        .close-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 1.8rem;
            color: #333;
            cursor: pointer;
            background: #f5f5f5;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }

        .close-btn:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-top: 15px;
            border-radius: var(--border-radius);
            border: 1px solid #e9effd;
            position: relative;
            background: #fafcff;
        }

        .preview-header {
            margin-bottom: 20px;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--secondary-color);
            word-break: break-word;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9effd;
        }

        #pdf-container {
            flex: 1;
            overflow: auto;
            background: #f9f9f9;
            position: relative;
        }

        .canvas-container {
            text-align: center;
            padding: 25px 0;
        }

        canvas {
            box-shadow: 0 5px 22px rgba(0, 0, 0, 0.12);
            margin-bottom: 30px;
            border-radius: 4px;
        }

        .preview-controls {
            padding: 18px 0;
            background: #f5f7fa;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .fallback-message {
            display: none;
            text-align: center;
            padding: 35px;
            background: #ffebee;
            border-radius: var(--border-radius);
            margin-top: 25px;
        }

        /* 删除确认框 */
        .modal.delete-modal {
            display: none;
        }

        .action-confirm {
            background: linear-gradient(135deg, #ffffff 0%, #f8faff 100%);
            border-radius: var(--border-radius);
            padding: 35px;
            width: 480px;
            max-width: 90%;
            text-align: center;
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(67, 97, 238, 0.2);
        }

        .action-confirm h2 {
            font-size: 1.7rem;
            color: var(--dark-text);
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .action-message {
            font-size: 1.2rem;
            margin-bottom: 35px;
            color: #4a5568;
            line-height: 1.6;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .batch-actions {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        /* 通知消息 */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 32px;
            border-radius: var(--border-radius);
            color: white;
            z-index: 1100;
            box-shadow: var(--box-shadow);
            transform: translateX(120%);
            transition: transform 0.4s ease;
            max-width: 480px;
            word-break: break-word;
            display: flex;
            align-items: center;
            gap: 18px;
            backdrop-filter: blur(3px);
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 1.7rem;
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success) 0%, #27ae60 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d35400 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .empty-message {
            text-align: center;
            padding: 50px 30px;
            color: #5a6779;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius);
        }

        .empty-message i {
            font-size: 5rem;
            color: #cbd5e0;
            margin-bottom: 30px;
            display: block;
        }

        .file-preview-info {
            text-align: center;
            font-size: 1.1rem;
            color: #67758a;
            margin-top: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .file-operations {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
        }

        .open-local-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 32px;
        }

        .open-local-btn:hover {
            background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
        }

        .view-options {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .view-option {
            padding: 10px 25px;
            background: linear-gradient(to right, #e3f2fd, #d6e7ff);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            color: #1976d2;
            border: 1px solid #bbdefb;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }

        .view-option:hover, .view-option.active {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
            transform: translateY(-2px);
        }

        .open-dialog {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            padding: 12px 28px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pdf-view-info {
            text-align: center;
            color: #718096;
            padding: 12px 0;
            font-size: 1rem;
            border-top: 1px solid #e2e8f0;
            margin-top: auto;
        }

        .page-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .page-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }

        .page-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .page-info {
            font-weight: 700;
            color: #4a5568;
            font-size: 1.1rem;
        }

        .pdfjs-warning {
            padding: 20px;
            background: #ffebee;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid var(--danger);
        }

        /* 网格视图样式 */
        .file-list.grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .file-list.grid-view .file-item {
            flex-direction: column;
            align-items: flex-start;
            padding: 25px;
            margin-bottom: 0;
        }

        .file-list.grid-view .file-icon {
            margin-right: 0;
            margin-bottom: 20px;
        }

        .file-list.grid-view .file-info {
            width: 100%;
        }

        .file-list.grid-view .file-meta {
            flex-direction: column;
            gap: 12px;
        }

        .file-list.grid-view .file-actions {
            width: 100%;
            justify-content: space-between;
            margin-top: 20px;
        }

        .file-list.grid-view .action-btn {
            flex: 1;
            width: auto;
            border-radius: 8px;
            padding: 12px;
            justify-content: center;
            font-size: 1rem;
            height: auto;
        }

        .file-list.grid-view .action-btn i {
            margin-right: 8px;
        }

        .file-list.grid-view .action-btn span {
            font-size: 1rem;
            font-weight: 600;
        }

        /* 列表视图样式 */
        .file-list.list-view .file-item {
            flex-direction: row;
            align-items: center;
        }

        .file-list.list-view .file-icon {
            margin-right: 25px;
            margin-bottom: 0;
        }

        .file-list.list-view .file-actions {
            width: auto;
            justify-content: flex-end;
        }

        .file-list.list-view .action-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        .file-list.list-view .action-btn span {
            display: none;
        }
        .zoom-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 8px 0 0 0;
        }
        .zoom-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        .zoom-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }
        .zoom-level {
            color: #4a5568;
            font-weight: 600;
            font-size: 1.08rem;
            width: 75px;
            text-align: center;
            background: transparent;
            border: none;
        }
        /* 让canvas自适应容器宽度，但不超过原始分辨率 */
        .canvas-container {
            text-align: center;
            padding: 25px 0;
            width: 100%;
            overflow-x: auto;
        }
        .canvas-container canvas {
            max-width: 100%;
            height: auto !important;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1><i class="fas fa-file-pdf"></i> 增强版PDF文件管理系统</h1>
        <p>最新版 · 新增直接打开功能 · 完整文件管理</p>
    </header>

    <div class="dashboard">
        <div class="card">
            <h2><i class="fas fa-cloud-upload-alt"></i> 上传PDF文件</h2>
            <div class="upload-area" id="upload-area">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>拖放PDF文件到此处，或</p>
                <button class="btn" id="browse-btn">选择文件</button>
                <p class="small">支持多个PDF文件同时上传</p>
            </div>
            <input type="file" id="file-input" accept=".pdf" multiple>

            <div class="upload-progress" id="upload-progress">
                <p>上传中: <span id="progress-file-name">文件名.pdf</span> <span id="progress-value">0%</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <div class="info-box" id="upload-info">
                <p><i class="fas fa-info-circle"></i> 文件已成功上传并添加到您的文档库中</p>
            </div>

            <div class="file-operations">
                <button class="btn open-local-btn" id="open-local-btn">
                    <i class="fas fa-folder-open"></i> 打开本地文件
                </button>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-search"></i> 搜索PDF文件</h2>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="输入PDF文件名称...">
                <button class="btn" id="search-btn">搜索</button>
            </div>

            <h2><i class="fas fa-sort"></i> 排序方式</h2>
            <div class="sort-options">
                <div class="sort-option active" data-sort="date-desc">
                    <i class="fas fa-arrow-down"></i> 最新上传
                </div>
                <div class="sort-option" data-sort="date-asc">
                    <i class="fas fa-arrow-up"></i> 最早上传
                </div>
                <div class="sort-option" data-sort="name-asc">
                    <i class="fas fa-sort-alpha-down"></i> 按名称A-Z
                </div>
                <div class="sort-option" data-sort="name-desc">
                    <i class="fas fa-sort-alpha-down-alt"></i> 按名称Z-A
                </div>
            </div>

            <div class="view-options">
                <div class="view-option" data-view="list">
                    <i class="fas fa-list"></i> 列表视图
                </div>
                <div class="view-option active" data-view="grid">
                    <i class="fas fa-grip"></i> 网格视图
                </div>
            </div>

            <h2><i class="fas fa-tasks"></i> 批量操作</h2>
            <div class="batch-actions">
                <button class="btn" id="select-all-btn"><i class="fas fa-check-square"></i> 全选</button>
                <button class="btn btn-danger" id="delete-selected-btn"><i class="fas fa-trash"></i> 删除选中</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>
            <i class="fas fa-folder"></i> PDF文档库
            <span class="file-count" id="file-count">0个文件</span>
        </h2>
        <div class="pdfjs-warning" id="pdfjs-warning">
            <i class="fas fa-exclamation-triangle"></i>
            部分PDF预览可能需要一些时间加载，较大文件建议直接"打开文件"
        </div>
        <div class="file-list grid-view" id="file-list">
            <div class="empty-message" id="empty-message">
                <i class="fas fa-inbox"></i>
                <p>暂无PDF文件，请上传您的PDF文档</p>
                <p class="file-preview-info">
                    解决预览问题：我们使用PDF.js库增强预览功能<br>
                    如仍有问题，请使用"下载后打开"功能
                </p>
            </div>
        </div>
    </div>
</div>

<!-- 预览模态框 -->
<div class="modal" id="preview-modal">
    <div class="modal-content">
        <div class="close-btn" id="close-preview">
            <i class="fas fa-times"></i>
        </div>
        <div class="preview-header" id="preview-header">PDF预览</div>

        <div class="preview-container">
            <!-- 新增缩放控件 -->
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoom-out" title="缩小"><i class="fas fa-search-minus"></i></button>
                <input class="zoom-level" id="zoom-level" readonly value="100%">
                <button class="zoom-btn" id="zoom-in" title="放大"><i class="fas fa-search-plus"></i></button>
                <button class="zoom-btn" id="zoom-reset" title="重置缩放"><i class="fas fa-sync"></i></button>
            </div>
            <div id="pdf-container"></div>

            <div class="preview-controls">
                <div class="page-nav">
                    <button class="page-btn" id="prev-page"><i class="fas fa-arrow-left"></i></button>
                    <span class="page-info">第 <span id="page-num"></span> 页 / 共 <span id="page-count"></span> 页</span>
                    <button class="page-btn" id="next-page"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <div class="pdf-view-info">
                我们使用PDF.js技术进行渲染，解决浏览器兼容性问题
            </div>
        </div>
    </div>
</div>

<!-- 打开确认框 -->
<div class="modal" id="open-confirm-modal">
    <div class="action-confirm">
        <h2><i class="fas fa-external-link-alt"></i> 打开文件确认</h2>
        <div class="action-message" id="open-confirm-message">请确认您想打开的PDF文件：</div>
        <div class="action-buttons">
            <button class="btn" id="cancel-open">取消</button>
            <button class="btn open-dialog" id="confirm-open">
                <i class="fas fa-external-link-alt"></i> 打开文件
            </button>
        </div>
    </div>
</div>

<!-- 删除确认框 -->
<div class="modal delete-modal" id="delete-modal">
    <div class="action-confirm">
        <h2><i class="fas fa-trash-alt"></i> 确认删除</h2>
        <div class="action-message" id="delete-message">确定要删除这个文件吗？此操作不可恢复。</div>
        <div class="action-buttons">
            <button class="btn" id="cancel-delete">取消</button>
            <button class="btn btn-danger" id="confirm-delete">确认删除</button>
        </div>
    </div>
</div>

<!-- 通知容器 -->
<div class="notification" id="notification"></div>

<script>
    // 存储PDF文件（初始为空）
    let pdfFiles = [];
    let currentFiles = [];
    let selectedFiles = [];
    let fileToDelete = null;
    let fileToOpen = null;
    let pdfDoc = null;
    let pageNum = 1;
    let pageRendering = false;
    let pageNumPending = null;
    let currentView = 'grid'; // 默认视图为网格视图

    // PDF.js配置
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    // DOM元素
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const browseBtn = document.getElementById('browse-btn');
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');
    const fileList = document.getElementById('file-list');
    const fileCount = document.getElementById('file-count');
    const sortOptions = document.querySelectorAll('.sort-option');
    const uploadProgress = document.getElementById('upload-progress');
    const progressFill = document.getElementById('progress-fill');
    const progressValue = document.getElementById('progress-value');
    const progressFileName = document.getElementById('progress-file-name');
    const uploadInfo = document.getElementById('upload-info');
    const emptyMessage = document.getElementById('empty-message');
    const notification = document.getElementById('notification');
    const openLocalBtn = document.getElementById('open-local-btn');
    const pdfjsWarning = document.getElementById('pdfjs-warning');
    const viewOptions = document.querySelectorAll('.view-option');
    const zoomOutBtn = document.getElementById('zoom-out');
    const zoomInBtn = document.getElementById('zoom-in');
    const zoomLevel = document.getElementById('zoom-level');
    const zoomResetBtn = document.getElementById('zoom-reset');
    let pdfScale = 1.0;
    const MIN_SCALE = 0.3;
    const MAX_SCALE = 5.0;
    const SCALE_STEP = 0.15;

    // 模态框元素
    const previewModal = document.getElementById('preview-modal');
    const previewHeader = document.getElementById('preview-header');
    const closePreview = document.getElementById('close-preview');
    const pdfContainer = document.getElementById('pdf-container');
    const openConfirmModal = document.getElementById('open-confirm-modal');
    const openConfirmMessage = document.getElementById('open-confirm-message');
    const cancelOpen = document.getElementById('cancel-open');
    const confirmOpen = document.getElementById('confirm-open');
    const deleteModal = document.getElementById('delete-modal');
    const deleteMessage = document.getElementById('delete-message');
    const cancelDelete = document.getElementById('cancel-delete');
    const confirmDelete = document.getElementById('confirm-delete');
    const prevPage = document.getElementById('prev-page');
    const nextPage = document.getElementById('next-page');
    const pageNumElem = document.getElementById('page-num');
    const pageCountElem = document.getElementById('page-count');

    // 批量操作按钮
    const selectAllBtn = document.getElementById('select-all-btn');
    const deleteSelectedBtn = document.getElementById('delete-selected-btn');

    // 当前排序方式
    let currentSort = 'date-desc';

    // 初始化应用
    document.addEventListener('DOMContentLoaded', () => {
        // 设置模态框事件
        setupModals();

        // 为UI添加事件监听器
        setupEventListeners();

        // 显示PDF.js提示
        setTimeout(() => {
            pdfjsWarning.style.display = 'block';
        }, 3000);
    });

    // 设置事件监听器
    function setupEventListeners() {
        // 缩放功能
        zoomInBtn.addEventListener('click', function() {
            setScale(pdfScale + SCALE_STEP);
        });
        zoomOutBtn.addEventListener('click', function() {
            setScale(pdfScale - SCALE_STEP);
        });
        zoomResetBtn.addEventListener('click', function() {
            setScale(1.0);
        });

        // PDF页面导航
        prevPage.addEventListener('click', onPrevPage);
        nextPage.addEventListener('click', onNextPage);

        // 浏览器窗口自适应canvas
        window.addEventListener('resize', function() {
            if (previewModal.style.display === 'flex' && pdfDoc) {
                queueRenderPage(pageNum);
            }
        });
        // 浏览文件按钮事件
        browseBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // 文件选择事件
        fileInput.addEventListener('change', function(e) {
            if (this.files.length > 0) {
                handleMultipleFileUpload(this.files);
            }
        });

        // 拖放功能
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });

        // 处理文件拖放
        uploadArea.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                handleMultipleFileUpload(files);
            }
        });

        // 搜索功能
        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') performSearch();
        });

        // 排序功能
        sortOptions.forEach(option => {
            option.addEventListener('click', () => {
                sortOptions.forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                currentSort = option.dataset.sort;
                sortFiles();
                renderFileList(currentFiles);
            });
        });

        // 视图切换功能
        viewOptions.forEach(option => {
            option.addEventListener('click', () => {
                viewOptions.forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                currentView = option.dataset.view;
                fileList.className = 'file-list ' + currentView + '-view';
                renderFileList(currentFiles);
            });
        });

        // 全选功能
        selectAllBtn.addEventListener('click', () => {
            if (selectedFiles.length === currentFiles.length) {
                selectedFiles = [];
                fileList.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
            } else {
                selectedFiles = [...currentFiles];
                fileList.querySelectorAll('.file-item').forEach(item => {
                    item.classList.add('selected');
                });
            }
            updateSelectedCount();
        });

        // 删除选中文件
        deleteSelectedBtn.addEventListener('click', () => {
            if (selectedFiles.length === 0) {
                showNotification('请先选择要删除的文件', 'warning');
                return;
            }

            fileToDelete = null;
            deleteMessage.textContent = `确定要删除选中的 ${selectedFiles.length} 个文件吗？此操作不可恢复。`;
            deleteModal.style.display = 'flex';

            const handler = () => {
                // 删除选中的文件
                const deletedIds = selectedFiles.map(f => f.id);
                pdfFiles = pdfFiles.filter(f => !deletedIds.includes(f.id));
                currentFiles = currentFiles.filter(f => !deletedIds.includes(f.id));

                // 更新UI
                selectedFiles = [];
                renderFileList(currentFiles);
                updateFileCount();
                showNotification(`已成功删除 ${deletedIds.length} 个文件`, 'success');

                confirmDelete.removeEventListener('click', handler);
            };

            confirmDelete.addEventListener('click', handler);
        });

        // 打开本地文件按钮
        openLocalBtn.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf';
            input.multiple = false;

            input.onchange = e => {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    fileToOpen = {
                        id: 'local-' + Date.now(),
                        name: file.name,
                        size: formatFileSize(file.size),
                        date: formatDate(new Date()),
                        timestamp: new Date().getTime(),
                        preview_url: URL.createObjectURL(file)
                    };

                    openConfirmMessage.textContent = `您确定要打开本地文件 "${file.name}" 吗？`;
                    openConfirmModal.style.display = 'flex';
                } else {
                    showNotification('请选择PDF文件', 'warning');
                }
            };

            input.click();
        });
    }

    // 设置模态框事件
    function setupModals() {
        // 预览模态框关闭事件
        closePreview.addEventListener('click', () => {
            previewModal.style.display = 'none';
            pdfDoc = null;
            pageNum = 1;
            pdfContainer.innerHTML = '';
        });

        // PDF页面导航
        prevPage.addEventListener('click', onPrevPage);
        nextPage.addEventListener('click', onNextPage);

        // 打开确认框
        cancelOpen.addEventListener('click', () => {
            openConfirmModal.style.display = 'none';
            fileToOpen = null;
        });

        confirmOpen.addEventListener('click', () => {
            openConfirmModal.style.display = 'none';
            if (fileToOpen) {
                openPDF(fileToOpen);
                fileToOpen = null;
            }
        });

        // 删除确认框
        cancelDelete.addEventListener('click', () => {
            deleteModal.style.display = 'none';
            fileToDelete = null;
        });

        confirmDelete.addEventListener('click', () => {
            if (fileToDelete) {
                deleteFile(fileToDelete);
            }
            deleteModal.style.display = 'none';
            fileToDelete = null;
        });

        // 点击模态框外部关闭
        [previewModal, openConfirmModal, deleteModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    fileToOpen = null;
                }
            });
        });
    }
    function setScale(newScale) {
        newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, newScale));
        if (Math.abs(newScale - pdfScale) > 1e-3) {
            pdfScale = newScale;
            zoomLevel.value = Math.round(pdfScale * 100) + '%';
            queueRenderPage(pageNum);
        }
        // 禁用边界按钮
        zoomInBtn.disabled = pdfScale >= MAX_SCALE - 1e-3;
        zoomOutBtn.disabled = pdfScale <= MIN_SCALE + 1e-3;
    }

    // PDF页面导航功能
    function onPrevPage() {
        if (pageNum <= 1) return;
        pageNum--;
        queueRenderPage(pageNum);
    }

    function onNextPage() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        queueRenderPage(pageNum);
    }

    // 渲染PDF页面
    function renderPage(num) {
        pageRendering = true;

        pdfDoc.getPage(num).then(function(page) {
            // 计算自适应缩放倍率
            let scale = pdfScale;
            // 获取容器宽度，实现自适应
            const containerWidth = pdfContainer.offsetWidth || 800;
            const viewport0 = page.getViewport({ scale: 1 });
            // 若pdfScale大于容器宽度则适应容器
            if (containerWidth < viewport0.width * pdfScale) {
                scale = containerWidth / viewport0.width;
            }
            scale = Math.max(scale, MIN_SCALE);
            const viewport = page.getViewport({ scale: scale });
            pdfContainer.innerHTML = '';
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const canvasWrapper = document.createElement('div');
            canvasWrapper.className = 'canvas-container';

            canvas.height = viewport.height;
            canvas.width = viewport.width;
            canvasWrapper.appendChild(canvas);
            pdfContainer.appendChild(canvasWrapper);

            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };

            const renderTask = page.render(renderContext);

            renderTask.promise.then(function() {
                pageRendering = false;
                if (pageNumPending !== null) {
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }
            });
        });

        // 更新页码显示
        pageNumElem.textContent = num;
        pageCountElem.textContent = pdfDoc.numPages;
        zoomLevel.value = Math.round(pdfScale * 100) + '%';
        zoomInBtn.disabled = pdfScale >= MAX_SCALE - 1e-3;
        zoomOutBtn.disabled = pdfScale <= MIN_SCALE + 1e-3;
    }

    // 队列渲染
    function queueRenderPage(num) {
        if (pageRendering) {
            pageNumPending = num;
        } else {
            pdfContainer.innerHTML = '';
            renderPage(num);
        }
    }
    // 打开PDF文件（使用PDF.js）
    function openPDF(file) {
        previewHeader.textContent = file.name;
        previewModal.style.display = 'flex';
        pdfContainer.innerHTML = '<div style="text-align:center; padding:50px; color:#4a5568; font-size:1.2rem; background:#f5f8ff; border-radius:12px; margin:20px;"><i class="fas fa-spinner fa-spin"></i> 正在加载PDF文件，请稍候...</div>';

        // 使用PDF.js加载PDF
        const loadingTask = pdfjsLib.getDocument(file.preview_url);

        loadingTask.promise.then(function(pdf) {
            pdfDoc = pdf;
            pageNum = 1;
            setScale(1.0); // 初始化为100%
            pageNumElem.textContent = pageNum;
            pageCountElem.textContent = pdfDoc.numPages;
            pdfContainer.innerHTML = '';
            renderPage(pageNum);

            // showNotification(`成功加载: ${file.name}`, 'success');
        }).catch(function(err) {
            console.error('PDF加载错误:', err);
            pdfContainer.innerHTML = `
                <div class="fallback-message" style="display:block;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>PDF预览失败: ${err.message}</p>
                    <p>请尝试使用"下载后打开"功能</p>
                    <button class="btn" onclick="downloadFile(${file.id})" style="margin-top:25px;">
                        下载文件
                    </button>
                </div>
            `;
        });
    }
    // 处理多个文件上传
    function handleMultipleFileUpload(files) {
        // 重置进度条
        resetProgress();
        const totalFiles = files.length;
        let processed = 0;

        // 显示上传进度
        uploadProgress.style.display = 'block';
        uploadInfo.style.display = 'none';

        // 处理每个文件
        for (let i = 0; i < totalFiles; i++) {
            const file = files[i];

            // 更新进度显示
            progressFileName.textContent = file.name;
            updateProgress(i+1, totalFiles);

            // 判断文件类型
            if (file.type !== 'application/pdf') {
                showNotification(`忽略不支持的文件: ${file.name}`, 'warning');
                processed++;
                continue;
            }

            // 模拟上传进度
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);

                    // 上传完成
                    setTimeout(() => {
                        // 添加到文件列表
                        addFileToLibrary(file);
                        processed++;

                        // 如果是最后一个文件
                        if (processed === totalFiles) {
                            uploadProgress.style.display = 'none';
                            uploadInfo.style.display = 'block';

                            // 重置进度条
                            setTimeout(() => {
                                resetProgress();
                                uploadInfo.style.display = 'none';
                            }, 3000);
                        }
                    }, 500);
                }

                progressFill.style.width = progress + '%';
                progressValue.textContent = Math.round(progress) + '%';
            }, 200);
        }
    }

    // 添加文件到库
    function addFileToLibrary(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const base64Data = e.target.result;

            // 添加到文件列表
            const currentDate = new Date();
            const fileSize = formatFileSize(file.size);

            const newFile = {
                id: Date.now() + Math.floor(Math.random() * 1000),
                name: file.name,
                date: formatDate(currentDate),
                timestamp: currentDate.getTime(),
                size: fileSize,
                download_url: base64Data,
                preview_url: base64Data
            };

            pdfFiles.push(newFile);
            currentFiles.push(newFile);

            // 更新UI
            sortFiles();
            renderFileList(currentFiles);
            updateFileCount();
            showNotification(`文件 "${file.name}" 上传成功！`, 'success');
        };
        reader.readAsDataURL(file);
    }

    // 格式化日期
    function formatDate(date) {
        return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
    }

    // 打开PDF文件（使用PDF.js）
    function openPDF(file) {
        previewHeader.textContent = file.name;
        previewModal.style.display = 'flex';
        pdfContainer.innerHTML = '<div style="text-align:center; padding:50px; color:#4a5568; font-size:1.2rem; background:#f5f8ff; border-radius:12px; margin:20px;"><i class="fas fa-spinner fa-spin"></i> 正在加载PDF文件，请稍候...</div>';

        // 使用PDF.js加载PDF
        const loadingTask = pdfjsLib.getDocument(file.preview_url);

        loadingTask.promise.then(function(pdf) {
            pdfDoc = pdf;
            pageNum = 1;
            pageNumElem.textContent = pageNum;
            pageCountElem.textContent = pdfDoc.numPages;

            pdfContainer.innerHTML = '';
            renderPage(pageNum);

            showNotification(`成功加载: ${file.name}`, 'success');
        }).catch(function(err) {
            console.error('PDF加载错误:', err);
            pdfContainer.innerHTML = `
                    <div class="fallback-message" style="display:block;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>PDF预览失败: ${err.message}</p>
                        <p>请尝试使用"下载后打开"功能</p>
                        <button class="btn" onclick="downloadFile(${file.id})" style="margin-top:25px;">
                            下载文件
                        </button>
                    </div>
                `;
        });
    }

    // 更新进度显示
    function updateProgress(current, total) {
        progressValue.textContent = `${Math.floor((current / total) * 100)}%`;
        progressFill.style.width = `${(current / total) * 100}%`;
    }

    // 重置进度条
    function resetProgress() {
        progressFill.style.width = '0%';
        progressValue.textContent = '0%';
    }

    // 搜索功能
    function performSearch() {
        const searchTerm = searchInput.value.toLowerCase().trim();

        if (searchTerm === '') {
            currentFiles = [...pdfFiles];
        } else {
            currentFiles = pdfFiles.filter(file =>
                file.name.toLowerCase().includes(searchTerm)
            );
        }

        sortFiles();
        renderFileList(currentFiles);
        updateFileCount();
    }

    // 排序功能
    function sortFiles() {
        switch (currentSort) {
            case 'date-asc':
                currentFiles.sort((a, b) => a.timestamp - b.timestamp);
                break;
            case 'date-desc':
                currentFiles.sort((a, b) => b.timestamp - a.timestamp);
                break;
            case 'name-asc':
                currentFiles.sort((a, b) => a.name.localeCompare(b.name));
                break;
            case 'name-desc':
                currentFiles.sort((a, b) => b.name.localeCompare(a.name));
                break;
        }
    }

    // 下载文件功能
    function downloadFile(file) {
        const a = document.createElement('a');
        a.href = file.download_url;
        a.download = file.name;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        showNotification(`正在下载: ${file.name}`, 'info');
    }

    // 删除文件功能
    function deleteFile(file) {
        // 删除文件
        pdfFiles = pdfFiles.filter(f => f.id !== file.id);
        currentFiles = currentFiles.filter(f => f.id !== file.id);

        renderFileList(currentFiles);
        updateFileCount();
        showNotification(`文件 "${file.name}" 已删除`, 'success');
    }

    // 显示删除确认对话框
    function confirmFileDelete(file) {
        fileToDelete = file;
        deleteMessage.textContent = `确定要删除文件 "${file.name}" 吗？此操作不可恢复。`;
        deleteModal.style.display = 'flex';
    }

    // 更新文件计数
    function updateFileCount() {
        fileCount.textContent = `${pdfFiles.length}个文件`;
    }

    // 渲染文件列表
    function renderFileList(files) {
        if (files.length === 0) {
            fileList.innerHTML = `
                    <div class="empty-message">
                        <i class="fas fa-inbox"></i>
                        <p>暂无PDF文件，请上传您的PDF文档</p>
                        <p class="file-preview-info">
                            解决预览问题：我们使用PDF.js库增强预览功能<br>
                            如仍有问题，请使用"下载后打开"功能
                        </p>
                    </div>
                `;
            return;
        }

        fileList.innerHTML = files.map(file => `
                <div class="file-item" data-id="${file.id}">
                    <div class="file-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">
                            <div class="file-date">
                                <i class="fas fa-calendar"></i>
                                ${file.date}
                            </div>
                            <div><i class="fas fa-weight-hanging"></i> ${file.size}</div>
                            <span class="status status-uploaded">已上传</span>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="action-btn open-btn" title="打开" data-id="${file.id}">
                            <i class="fas fa-external-link-alt"></i>
                            <span>打开</span>
                        </button>
                        <button class="action-btn download-btn" title="下载" data-id="${file.id}">
                            <i class="fas fa-download"></i>
                            <span>下载</span>
                        </button>
                        <button class="action-btn delete-btn" title="删除" data-id="${file.id}">
                            <i class="fas fa-trash"></i>
                            <span>删除</span>
                        </button>
                    </div>
                </div>
            `).join('');

        // 为操作按钮添加事件监听
        document.querySelectorAll('.open-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const fileId = parseInt(e.currentTarget.dataset.id);
                const file = files.find(f => f.id === fileId);
                if (file) {
                    fileToOpen = file;
                    openConfirmMessage.textContent = `您确定要打开文件 "${file.name}" 吗？`;
                    openConfirmModal.style.display = 'flex';
                }
            });
        });

        document.querySelectorAll('.download-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const fileId = parseInt(e.currentTarget.dataset.id);
                const file = files.find(f => f.id === fileId);
                if (file) downloadFile(file);
            });
        });

        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const fileId = parseInt(e.currentTarget.dataset.id);
                const file = files.find(f => f.id === fileId);
                if (file) confirmFileDelete(file);
            });
        });
    }

    // 全选功能
    function updateSelectedCount() {
        if (selectedFiles.length === 0) {
            deleteSelectedBtn.textContent = '删除选中';
        } else {
            deleteSelectedBtn.textContent = `删除选中 (${selectedFiles.length})`;
        }
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    // 显示通知
    function showNotification(message, type = 'info') {
        const icon = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        }[type];

        notification.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
        notification.className = `notification ${type} show`;

        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // 辅助函数
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight() {
        uploadArea.classList.add('dragover');
    }

    function unhighlight() {
        uploadArea.classList.remove('dragover');
    }

    // 暴露下载文件功能给UI
    window.downloadFile = downloadFile;
</script>
</body>
</html>
